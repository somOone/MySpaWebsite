# Appointment Booking Validation Rules

## General Instruction
Always enforce and test these validation rules across all appointment booking code, including controllers, services, models, and test suites.  
Do not skip or bypass these rules unless explicitly instructed.

---

## Required Fields Validation
- **Date**: Must be in ISO8601 format (YYYY-MM-DD)
- **Time**: Must not be empty
- **Client**: Must not be empty (client name required)
- **Category**: Must be one of: 'Facial', 'Massage', 'Facial + Massage'

---

## Date Validation
- **Cannot book in the past**: Date must be today or in the future
- **Cannot book on Sundays**: Sunday appointments are not allowed
- **Cannot book more than 45 days in advance**: Maximum booking window is 45 days

---

## Date Availability Rules
- **Date only available if open slots exist**: A date will only be available to pick if there are open time slots based on time slot rules
- **No availability = date not selectable**: If all time slots are booked or conflict with spacing rules, the date is not available for booking

---

## Time Validation
- **Operating hours**: Appointments can only be booked between 2:00 PM and 8:00 PM
- **Time format**: Must be in 12-hour format with AM/PM

---

## Time Slot Selection Rules
- **Only display open time slots**: The time slot selector will only display time slots that are actually available
- **Hide booked slots**: Already booked time slots are not shown to users
- **Hide conflicting slots**: Time slots that would violate the 30-minute gap rule are not displayed

---

## Appointment Duration & Spacing
- **Appointment duration**: Each appointment lasts exactly 1 hour
- **Minimum gap requirement**: There must be at least 30 minutes between the end of one appointment and the start of another
- **Example**: If there's a 2:00 PM appointment (ends at 3:00 PM), the next available slot would be 3:30 PM (30-minute gap)

---

## Conflict Prevention
- **No double-booking**: Exact time slot cannot already be booked
- **No overlap**: New appointments cannot overlap with existing appointments
- **Gap enforcement**: System checks that new appointments maintain the 30-minute buffer

---

## Business Logic
- **Payment calculation**: Automatically set based on category (Facial: $100, Massage: $120, Facial + Massage: $200)
- **Category validation**: Only predefined service categories are allowed

---

## Error Handling
- **Validation errors**: Return 400 status with specific error messages
- **Database errors**: Return 500 status for system failures
- **Conflict errors**: Return 400 status with conflict-specific messages

---

## Testing Requirement
When writing tests:
- Always include **valid** and **invalid** test cases for each validation rule
- Ensure error messages match expected validation failures
- Test edge cases (boundary dates, conflicting appointments, etc.)

---
alwaysApply: true
---
description: Appointment booking validation rules that must always be enforced
globs: ["**/*.js", "**/*.jsx", "**/*.ts", "**/*.tsx"]
alwaysApply: true
---
